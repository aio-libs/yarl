Reworked the internal encoding cache to improve performance on cache hit -- by :user:`bdraco`.
